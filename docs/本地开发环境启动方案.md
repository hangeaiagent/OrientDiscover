# 🧭 OrientDirector 本地开发环境启动方案

## 📋 概述

本文档记录了经过验证的本地开发环境启动方案，基于2025年9月7日的成功启动流程创建。

### ✅ 验证状态
- **测试时间**: 2025年9月7日 13:39
- **Python版本**: Python 3.9.23 (orient conda环境)
- **服务状态**: 前后端服务正常启动
- **认证服务**: Supabase认证正常
- **环境配置**: 本地开发环境配置正确

---

## 🚀 快速启动

### 一键启动（推荐）
```bash
# 使用专用的本地开发启动脚本
./start_local_dev.sh
```

### 手动启动步骤
```bash
# 1. 激活conda环境
conda activate orient

# 2. 设置本地环境变量
export isUsedomainnameaddress=false
./set_environment.sh local

# 3. 安装/更新依赖
pip install -r requirements.txt
pip install pydantic[email]

# 4. 创建日志目录
mkdir -p logs backend/logs

# 5. 启动服务
python start_all.py
```

---

## 🔧 环境配置详情

### 必需的环境要求
- **Python版本**: 3.9.23 (通过conda环境管理)
- **Conda环境**: `orient`
- **环境变量**: `isUsedomainnameaddress=false`
- **端口配置**: 前端3001，后端8001

### 关键依赖包
```txt
fastapi>=0.104.1
uvicorn>=0.24.0
pydantic[email]  # 包含email-validator
google-genai==1.33.0
supabase>=2.0.0
# ... 其他依赖见requirements.txt
```

### 环境变量配置
```bash
# 本地开发环境
export isUsedomainnameaddress=false

# 对应的API配置
API_BASE_URL=http://localhost:8001
```

---

## 📊 服务验证

### 健康检查端点
```bash
# 后端服务健康检查
curl http://localhost:8001/api/health
# 预期响应: {"status":"healthy","service":"方向探索派对API","version":"1.0.0"}

# 环境配置检查
curl http://localhost:8001/api/config/environment
# 预期响应: {"success":true,"environment":"local","api_base_url":"http://localhost:8001",...}

# 认证服务检查
curl http://localhost:8001/api/auth/health
# 预期响应: {"status":"healthy","supabase_available":true,...}

# 前端服务检查
curl http://localhost:3001/
# 预期响应: HTML页面内容
```

### 服务状态验证
| 服务 | 地址 | 状态检查 | 预期结果 |
|------|------|----------|----------|
| 前端 | http://localhost:3001 | 页面加载 | ✅ 正常 |
| 后端API | http://localhost:8001 | /api/health | ✅ 正常 |
| 环境配置 | http://localhost:8001 | /api/config/environment | ✅ local环境 |
| 认证服务 | http://localhost:8001 | /api/auth/health | ✅ Supabase可用 |

---

## 🎯 登录测试

### 测试步骤
1. **打开应用**: 访问 http://localhost:3001
2. **点击登录**: 使用Supabase认证
3. **验证功能**: 测试主要功能是否正常

### 认证配置
- **认证提供商**: Supabase
- **JWT验证**: 已配置正确的JWT Secret
- **环境适配**: 本地环境使用localhost API

---

## 📁 文件结构

### 启动相关文件
```
OrientDirector/
├── start_local_dev.sh          # 本地开发专用启动脚本 ⭐
├── start_all.py                # 统一启动脚本
├── set_environment.sh          # 环境配置脚本
├── requirements.txt            # Python依赖
├── logs/                       # 日志目录
│   └── backend.log            # 后端日志
├── backend/
│   ├── logs/                  # 后端日志目录
│   └── main.py               # 后端入口
└── docs/
    ├── 本地启动指南.md         # 通用启动指南
    └── 本地开发环境启动方案.md  # 本文档 ⭐
```

### 配置文件
- **环境配置**: `set_environment.sh`
- **依赖管理**: `requirements.txt`
- **环境变量**: `.env` (如果存在)

---

## 🛠️ 故障排查

### 常见问题及解决方案

#### 1. email-validator缺失
**错误**: `ImportError: email-validator is not installed`
**解决**: 
```bash
pip install pydantic[email]
```

#### 2. 端口被占用
**错误**: 端口8001或3001被占用
**解决**:
```bash
lsof -ti :8001 | xargs kill -9
lsof -ti :3001 | xargs kill -9
```

#### 3. conda环境问题
**错误**: Python版本不是3.9
**解决**:
```bash
conda activate orient
python --version  # 确认是Python 3.9.23
```

#### 4. 环境配置错误
**错误**: API调用失败，环境配置不正确
**解决**:
```bash
./set_environment.sh local
./set_environment.sh status  # 验证配置
```

#### 5. 日志目录缺失
**错误**: 无法创建日志文件
**解决**:
```bash
mkdir -p logs backend/logs
```

---

## 📝 开发工作流

### 日常开发流程
1. **启动环境**: `./start_local_dev.sh`
2. **开发调试**: 修改代码，服务自动重载
3. **测试验证**: 浏览器测试功能
4. **查看日志**: `tail -f logs/backend.log`
5. **停止服务**: `Ctrl+C`

### 环境切换
```bash
# 查看当前环境
./set_environment.sh status

# 切换到生产环境（用于测试）
./set_environment.sh production

# 切换回本地环境
./set_environment.sh local
```

### 浏览器调试
```javascript
// 在浏览器控制台中
EnvironmentConfig.showStatus();           // 查看环境状态
EnvironmentConfig.setUseDomainName(false); // 设置本地环境
EnvironmentConfig.getCurrentAPIBaseURL();  // 获取当前API URL
```

---

## 🔍 监控和日志

### 日志文件位置
- **后端日志**: `logs/backend.log`
- **前端日志**: 浏览器开发者工具控制台

### 实时日志监控
```bash
# 监控后端日志
tail -f logs/backend.log

# 监控所有日志
tail -f logs/*.log
```

### 关键日志信息
- 服务启动信息
- API请求响应
- 认证状态变化
- 错误和异常信息

---

## 🎉 成功标准

### 启动成功指标
- ✅ 后端服务响应 `/api/health`
- ✅ 前端页面正常加载
- ✅ 环境配置为 `local`
- ✅ 认证服务可用
- ✅ 无关键错误日志

### 功能测试通过
- ✅ 用户登录/注册
- ✅ 主要功能模块
- ✅ API调用正常
- ✅ 页面交互流畅

---

## 📚 相关文档

- [本地启动指南.md](./本地启动指南.md) - 通用启动指南
- [0904本地开发及服务器部署状态变量.md](./0904本地开发及服务器部署状态变量.md) - 环境配置详情
- [README.md](../README.md) - 项目总体说明

---

## 📋 更新记录

| 日期 | 版本 | 更新内容 | 状态 |
|------|------|----------|------|
| 2025-09-07 | 1.0 | 初始版本，基于成功启动流程 | ✅ 验证通过 |

---

## 🎯 总结

本启动方案已经过完整验证，包括：

### ✅ 已验证功能
1. **环境配置** - 本地开发环境正确设置
2. **服务启动** - 前后端服务正常运行
3. **依赖管理** - 所有必需依赖已安装
4. **认证服务** - Supabase认证系统正常
5. **API通信** - 前后端通信正常
6. **日志系统** - 日志记录和监控正常

### 🚀 使用建议
- **推荐使用**: `./start_local_dev.sh` 一键启动
- **开发调试**: 使用浏览器开发者工具
- **环境切换**: 使用 `set_environment.sh` 脚本
- **问题排查**: 参考故障排查章节

**最后更新**: 2025年9月7日  
**验证状态**: ✅ 完全通过  
**维护人员**: Claude Sonnet 4 AI Assistant
